---
- hosts: localservers
  remote_user: vagrant
  sudo: yes
  tasks:
  - name: Ensure apt-get is updated
    apt: update_cache=yes
  - name: Install NodeJS
    apt: name=nodejs state=present
  - name: Install NPM
    apt: name=npm state=present
  - name: Install CURL
    apt: name=curl state=present

- hosts: apache
  remote_user: vagrant
  tasks:
  - name: Ensure Apache Installed
    apt: name=apache2 state=present

  - name: Install PHP
    apt: name=php5 state=present
  - name: Install PHP MySQL
    apt: name=php5-mysql state=present
  - name: Install PHP GD
    apt: name=php5-gd state=present
  - name: Install PHP CURL
    apt: name=php5-curl state=present
  - name: Install PHP Mcrypt
    apt: name=php5-mcrypt state=present
  - name: Install APACHE TO PHP MODULE
    apt: name=libapache2-mod-php5 state=present

  - name: ENable VHOST Modules
    command: a2enmod vhost_alias headers
# These can be enabled w/ ansible 1.6
#    apache2_module: state=present name=vhost
#    apache2_module: state=present name=headers


  - name: Copy Vhost Definition over
    copy: src=templates/vhosts.conf dest=/etc/apache2/conf.d/vhost.conf


  - name: Ensure Apache Started
    service: name=apache2 state=running enabled=yes

  - name: Restart Apache
    command: apachectl restart
